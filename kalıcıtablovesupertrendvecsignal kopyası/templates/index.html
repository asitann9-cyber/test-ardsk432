<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🎯 Supertrend + C-Signal Analiz Sistemi</title>
  
  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/tr.min.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <div class="container">
    <!-- Main Header -->
    <div class="main-header">
      <h1 class="main-title">
        <span>🎯</span>
        Supertrend + C-Signal Analiz Sistemi
      </h1>
      <p class="main-subtitle">
        Binance Vadeli İşlemler - Supertrend Ratio % + Z-Score + C-Signal + MANUEL TÜR DEĞİŞTİRME
      </p>
    </div>

    <!-- Symbol Management Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span>💰</span>
          Emtia Yönetimi
        </div>
      </div>
      
      <div class="controls-grid">
        <div class="form-group">
          <label class="form-label">🔍 Mevcut Emtialar</label>
          <select id="available-symbols" multiple size="6" style="height: 150px;">
            <option disabled>Yükleniyor...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">✅ Seçili Emtialarım</label>
          <div id="selected-symbols-list" style="height: 150px; overflow-y: auto; background: var(--darker-bg); border: 2px solid var(--border-color); border-radius: 8px; padding: 10px;">
            <div style="color: var(--text-muted); font-style: italic;">Henüz emtia seçilmedi</div>
          </div>
        </div>
      </div>
      
      <div class="btn-group">
        <button id="add-symbols" class="btn btn-success">
          <span>➕</span>
          Seçili Emtiaları Ekle
        </button>
        <button id="select-all" class="btn btn-warning">
          <span>📊</span>
          Tümünü Seç
        </button>
        <button id="refresh-symbols" class="btn btn-info">
          <span>🔄</span>
          Listeyi Yenile
        </button>
        <button id="clear-symbols" class="btn btn-danger">
          <span>🗑️</span>
          Tümünü Temizle
        </button>
      </div>
      
      <div class="status-message status-info" id="symbol-status">
        📊 Emtia listesi yükleniyor...
      </div>
    </div>

    <!-- Analysis Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span>🎯</span>
          Supertrend Analizi
        </div>
      </div>
      
      <div class="controls-grid">
        <div class="form-group">
          <label class="form-label">⏰ Timeframe</label>
          <select id="timeframe">
            <option value="1m">1 Dakika</option>
            <option value="5m">5 Dakika</option>
            <option value="15m">15 Dakika</option>
            <option value="30m">30 Dakika</option>
            <option value="1h">1 Saat</option>
            <option value="2h">2 Saat</option>
            <option value="4h" selected>4 Saat</option>
            <option value="1d">1 Gün</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">🎯 İşlem</label>
          <button id="start-analysis" class="btn btn-primary">
            <span>🚀</span>
            Analiz Başlat
          </button>
        </div>
        
        <div class="form-group">
          <label class="form-label">⏹️ Durdur</label>
          <button id="stop-auto-update" class="btn btn-danger" disabled>
            <span>⏹️</span>
            Durdur
          </button>
        </div>
      </div>
      
      <div class="status-message status-info" id="analysis-status">
        📊 Analiz için butona tıklayın
      </div>
    </div>

    <!-- Results Section - Supertrend Analizi -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span>📈</span>
          Analiz Sonuçları - Supertrend Ratio % + Z-Score
        </div>
      </div>
      
      <!-- Filter Buttons -->
      <div class="filter-buttons" style="margin-bottom: 15px; display: flex; gap: 5px; flex-wrap: wrap; align-items: center;">
        
        <!-- ARAMA KUTUSU - OTOMATIK TAMAMLAMA -->
        <div class="search-container" style="margin-right: 15px; position: relative;">
          <input type="text" 
                 id="symbol-search" 
                 placeholder="🔍 Sembol ara (ör: BTC, ETH, M)"
                 style="padding: 8px 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--darker-bg); color: var(--text-primary); font-size: 13px; width: 220px; font-weight: 500;"
                 autocomplete="off">
          <div id="search-dropdown" class="search-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--card-bg); border: 2px solid var(--border-color); border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
            <!-- Öneri listesi buraya gelecek -->
          </div>
        </div>
        
        <button id="filter-all" class="btn-filter active">
          📊 HEPSİ
        </button>
        <button id="filter-bullish" class="btn-filter">
          🟢 BULLISH
        </button>
        <button id="filter-bearish" class="btn-filter">
          🔴 BEARISH
        </button>
        <button id="filter-high-ratio" class="btn-filter">
          🔥 %100+ RATİO
        </button>
        <div style="margin-left: auto; font-size: 12px; color: var(--text-muted); display: flex; align-items: center;">
          <span id="filter-count">0 sonuç</span>
        </div>
      </div>
      
      <div style="max-height: 600px; overflow-y: auto; background: var(--darker-bg); border-radius: 8px; border: 2px solid var(--border-color);">
        <table id="consecutive-results-table">
          <thead>
            <tr>
              <th>Sıra</th>
              <th>Sembol</th>
              <th>Fiyat</th>
              <th>Ratio %</th>
              <th>Z-Score</th>
              <th>🏆 Manuel Ekle</th>
            </tr>
          </thead>
          <tbody id="consecutive-results-tbody">
            <tr>
              <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-muted);">
                📊 Analiz sonuçları burada görünecek
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Permanent High Ratio Section -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span>🏆</span>
          Kalıcı %100+ Ratio Emtialar - MANUEL TÜR DEĞİŞTİRME
        </div>
        <div class="btn-group">
          <button id="refresh-permanent" class="btn btn-info">
            <span>🔄</span>
            Yenile
          </button>
          <button id="clear-permanent" class="btn btn-danger">
            <span>🗑️</span>
            Temizle
          </button>
        </div>
      </div>
      
      <div class="status-message status-info" id="permanent-status">
        🏆 %100+ ratio olan emtialar + Manuel tür değiştirme
      </div>
      
      <div style="max-height: 500px; overflow-y: auto; background: var(--darker-bg); border-radius: 8px; border: 2px solid var(--border-color);">
        <table id="permanent-results-table">
          <thead>
            <tr>
              <th>Sıra</th>
              <th>Sembol</th>
              <th>İlk Kayıt</th>
              <th>Max Ratio %</th>
              <th>📝 Trend Türü</th>
              <th>C-Signal</th>
              <th>🗑️ İşlem</th>
            </tr>
          </thead>
          <tbody id="permanent-results-tbody">
            <tr>
              <td colspan="7" style="padding: 20px; text-align: center; color: var(--text-muted);">
                🏆 Henüz %100+ ratio olan emtia yok
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- SİSTEM AÇIKLAMASI -->
      <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, rgba(41, 98, 255, 0.1), rgba(52, 152, 219, 0.1)); border: 1px solid var(--primary-color); border-radius: 8px; font-size: 12px; color: var(--text-secondary);">
        <strong>🎯 Supertrend Analiz Sistemi:</strong><br>
        📊 <strong>Supertrend Ratio</strong>: Pullback seviyesinden mevcut fiyatın uzaklığı (%)<br>
        📈 <strong>Z-Score</strong>: İstatistiksel aşırılık ölçümü (±2 üzeri yüksek)<br>
        💡 <strong>C-Signal</strong>: RSI momentum değişimi (trend gücü göstergesi)<br>
        📝 <strong>Manuel Tür Değiştirme</strong>: Dropdown'dan Bullish/Bearish değiştirme = Tür kilitlenir<br>
        🎯 <strong>Kalıcı Kriter</strong>: Supertrend Ratio >= %100 (mutlak değer)<br>
        🔒 <strong>Manuel Kilitleme</strong>: Değiştirilen tür otomatik güncellemelerde korunur
      </div>
    </div>
  </div>

  <!-- JavaScript dosyası -->
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>